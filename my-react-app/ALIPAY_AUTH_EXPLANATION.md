# ุดุฑุญ ุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ Alipay

## ๐ฑ ูุง ูู ุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ Alipayุ

ุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ Alipay ูุนูู ุฃู ุงููุณุชุฎุฏู ูุณุชุฎุฏู ุญุณุงุจ Alipay ุงูุฎุงุต ุจู ููุฏุฎูู ุฅูู ุงูุชุทุจููุ ุจุฏูุงู ูู ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ.

## ๐ ููู ูุนููุ

### ุงูุฎุทูุฉ 1: ุงููุณุชุฎุฏู ูุถุบุท ุนูู "ุชุณุฌูู ุงูุฏุฎูู"
- ุงููุณุชุฎุฏู ููุชุญ ุงูุชุทุจูู ููุฑู ุฒุฑ "ุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ Alipay"
- ุนูุฏ ุงูุถุบุทุ ูุชู ุงุณุชุฏุนุงุก API ูู Alipay

### ุงูุฎุทูุฉ 2: ุงูุญุตูู ุนูู Authorization Code
```javascript
// ุงูููุฏ ูุณุชุฏุนู:
window.my.getAuthCode({
  scopes: ['auth_base', 'auth_user'],
  success: (res) => {
    // res.authCode ูู ุงูุฑูุฒ ุงูุฐู ูุญุตู ุนููู
    console.log(res.authCode); // ูุซุงู: "0000000001T1dc0W0tv448DB00007826"
  }
});
```

### ุงูุฎุทูุฉ 3: ุฅุฑุณุงู ุงูุฑูุฒ ุฅูู ุงูุฎุงุฏู (Backend)
```javascript
// ุงูุชุทุจูู ูุฑุณู authCode ุฅูู ุฎุงุฏูู:
POST /api/auth/token
Body: { authCode: "0000000001T1dc0W0tv448DB00007826" }
```

### ุงูุฎุทูุฉ 4: ุงูุฎุงุฏู ูุณุชุจุฏู authCode ุจู accessToken
- ุงูุฎุงุฏู ูุฑุณู `authCode` ุฅูู Alipay API
- Alipay ูุชุญูู ูู ุงูุฑูุฒ ููุนูุฏ `accessToken` ู `refreshToken`
- ุงูุฎุงุฏู ูุญูุธ ูุนูููุงุช ุงููุณุชุฎุฏู ููุนูุฏ `accessToken` ููุชุทุจูู

### ุงูุฎุทูุฉ 5: ุงูุชุทุจูู ูุญูุธ accessToken
- ุงูุชุทุจูู ูุญูุธ `accessToken` ูู localStorage
- ูุณุชุฎุฏูู ูู ุฌููุน ุงูุทูุจุงุช ุงูุชุงููุฉ ููุฎุงุฏู

## ๐ ุงูุตูุงุญูุงุช (Scopes)

### `auth_base` โ
- **ุงููุตู**: ุงูุญุตูู ุนูู User ID ููุท
- **ุงูููุน**: ุชูููุถ ุตุงูุช (Silent Authorization)
- **ุงููุนูู**: ูุง ูุญุชุงุฌ ููุงููุฉ ุงููุณุชุฎุฏูุ ูุชู ุชููุงุฆูุงู

### `auth_user` โ๏ธ
- **ุงููุตู**: ุงูุญุตูู ุนูู ูุนูููุงุช ุงููุณุชุฎุฏู ุงููุงููุฉ
- **ุงูููุน**: ุชูููุถ ุตุฑูุญ (Explicit Authorization)
- **ุงููุนูู**: ูุญุชุงุฌ ููุงููุฉ ุงููุณุชุฎุฏู
- **ุงูุจูุงูุงุช**: ุงูุงุณูุ ุงูุตูุฑุฉุ ุงูุฌูุณุ ุชุงุฑูุฎ ุงููููุงุฏุ ุงูุฌูุณูุฉุ ูุนูููุงุช ุงูุงุชุตุงู

## ๐ป ูุซุงู ูุงูู ูู ุงูููุฏ:

```typescript
// 1. ุงููุณุชุฎุฏู ูุถุบุท ุงูุฒุฑ
const handleLogin = async () => {
  await login(['auth_base', 'auth_user']);
};

// 2. login() ูุณุชุฏุนู getAuthCode()
async getAuthCode(scopes: string[]): Promise<string> {
  return new Promise((resolve, reject) => {
    window.my.getAuthCode({
      scopes: scopes,
      success: (res) => {
        resolve(res.authCode); // ุงูุญุตูู ุนูู authCode
      },
      fail: (err) => {
        reject(err); // ุฎุทุฃ ูู ุงูุชูููุถ
      }
    });
  });
}

// 3. exchangeAuthCode() ูุฑุณู authCode ููุฎุงุฏู
async exchangeAuthCode(authCode: string): Promise<AuthResponse> {
  const response = await axios.post('/auth/token', { authCode });
  return response.data; // { accessToken, refreshToken, user }
}
```

## ๐ฏ ุงูููุงุฆุฏ

1. **ุณูููุฉ ุงูุงุณุชุฎุฏุงู**: ุงููุณุชุฎุฏู ูุง ูุญุชุงุฌ ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ
2. **ุงูุฃูุงู**: Alipay ูุฏูุฑ ุงููุตุงุฏูุฉ ูุงูุฃูุงู
3. **ุงูุจูุงูุงุช ุงูููุซููุฉ**: ุงูุจูุงูุงุช ุชุฃุชู ูุจุงุดุฑุฉ ูู Alipay
4. **ุชุฌุฑุจุฉ ุณูุณุฉ**: ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู ุจุถุบุทุฉ ูุงุญุฏุฉ

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ูุนูู ููุท ุฏุงุฎู Alipay Mini App**: 
   - `window.my.getAuthCode` ูุชููุฑ ููุท ุฏุงุฎู ุชุทุจูู Alipay
   - ูู ุงููุชุตูุญ ุงูุนุงุฏูุ ุณููุดู

2. **ูุญุชุงุฌ Backend API**:
   - ูุฌุจ ุฃู ูููู ูุฏูู ุฎุงุฏู (Backend) ูุชูุงุตู ูุน Alipay API
   - ุงูุชุทุจูู ูุง ูุชูุงุตู ูุจุงุดุฑุฉ ูุน Alipay ููุงุณุชุจุฏุงู

3. **ุงูุชุทููุฑ ูุงูุงุฎุชุจุงุฑ**:
   - ููุชุทููุฑุ ููููู ุงุณุชุฎุฏุงู ุจูุงูุงุช ููููุฉ (Mock Data)
   - ููุงุฎุชุจุงุฑ ุงูุญููููุ ุชุญุชุงุฌ ุชุดุบูู ุงูุชุทุจูู ุฏุงุฎู Alipay Mini App

## ๐ ุงููุฒูุฏ ูู ุงููุนูููุงุช

- [Alipay Mini Program Documentation](https://opendocs.alipay.com/mini)
- [User Authorization API](https://opendocs.alipay.com/mini/api/getAuthCode)

